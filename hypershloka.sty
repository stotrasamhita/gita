%% Style file
%\newif\@ifvsp
%\@ifvsp=true
\newdimen\@tempdima
\newdimen\@tempdimb
\newdimen\shlokaspaceskip
\shlokaspaceskip=2.4em
\newdimen\shlokavskip
\shlokavskip=0em
\newcommand{\shlokamidskip}{\vskip -0.2em}
\newcommand{\shlokatopskip}{\vskip 0.2em plus 0.5em minus 0.2em}
\newbox\@tempboxa
\newbox\@tempboxb
\newbox\@tempboxc
\newbox\@tempboxd

\RequirePackage{refcount}
\newif\ifpadaccheda

\RequirePackage[no-math]{fontspec}
\defaultfontfeatures{Scale=MatchLowercase,Mapping=tex-text}
% \RequirePackage{pdfpages}
\RequirePackage{xunicode}
\RequirePackage{xltxtra}
\RequirePackage{titlesec}
\RequirePackage{multicol}


\newcommand{\pagenumfont}{\fontspec{Noto Sans}}

\RequirePackage[titles]{tocloft}
\renewcommand\contentsname{अनुक्रमणिका}
\renewcommand{\partname}{विभागः}
\renewcommand{\thepart}{{\dndigit{\arabic{part}}}}
\renewcommand{\cftchappagefont}{\fontspec{Noto Sans Bold}}
\renewcommand{\cftpartpagefont}{\fontspec{Noto Sans Bold}}
\renewcommand{\cftsecpagefont}{\fontspec{Noto Sans}}
\renewcommand{\cftpartfont}{\LARGE\fontspec[Script=Devanagari]{Sanskrit 2003}}
\renewcommand{\cftchapfont}{\Large\fontspec[Script=Devanagari]{Sanskrit 2003}}
\renewcommand{\cftsecfont}{\fontspec[Script=Devanagari]{Sanskrit 2003}}
\renewcommand{\cfttoctitlefont}{\LARGE\fontspec[Script=Devanagari]{Sanskrit 2003}}
%\renewcommand{\cftpartfont}{\LARGE\fontspec[Script=Devanagari]{Siddhanta}}
%\renewcommand{\cftchapfont}{\Large\fontspec[Script=Devanagari]{Siddhanta}}
%\renewcommand{\cftsecfont}{\fontspec[Script=Devanagari]{Siddhanta}}
%\renewcommand{\cfttoctitlefont}{\LARGE\fontspec[Script=Devanagari]{Siddhanta}}
%\newcommand{\s}{~$\cdot$}
%\newcommand{\vsp}{\vspace{\stretch{1}}}
\newcommand{\vsp}{\medskip}
%%%%%%% Numbers and counters %%%%%%%
\newcount\num
\newcount\tempone \newcount\temptwo
\newcommand{\devanumber}[1]{%
\num=#1\devanumberrecurse}

\newcommand{\devanumberrecurse}{%
{\tempone=\num
%  \showthe\tempone\ %
\ifnum\num > 0 
	\divide \num by 10%
	\temptwo=\num \multiply\temptwo by -10%
	\devanumberrecurse%
% 	\\stage 2\ %
% 	\showthe\temptwo\ %
% 	temp1=\number\tempone\ %
% 	num=\number\num\ %
	\advance\tempone by \temptwo%
	\devadigit
\fi
}}

\newcommand{\devadigit}{%
\ifcase\tempone०\or१\or२\or३\or४\or५\or६\or७\or८\or९\fi%\number\tempone%
}

\newcommand{\dndigit}[1]{%
\ifcase#1०\or१\or२\or३\or४\or५\or६\or७\or८\or९\fi%
}
%Shloka Counter
\newcounter{shlokacount}
\newcounter{shlokalink}
\newcommand{\nextShloka}{\stepcounter{shlokacount}\stepcounter{shlokalink}\devanumber\c@shlokacount\relax}


\def\PageOffset{66} % Number of pages in Moola mode

\renewcommand{\nextShloka}{%
  \stepcounter{shlokacount}%
  % Calculate the Target Page%
  \ifpadaccheda%
    % If in Split mode (e.g. Pg 68), subtract 67 -> Jump to Pg 1
    \num\numexpr\value{page}-\PageOffset\relax%
    \edef\targetPage{page.\the\num}%
  \else%
    % If in Moola mode (e.g. Pg 1), add 67 -> Jump to Pg 68%
    \num\numexpr\value{page}+\PageOffset\relax%
    \edef\targetPage{page.\the\num}%
  \fi
  % Create the Link
  \hyperlink{\targetPage}{\devanumber\c@shlokacount\relax}%
}

\renewcommand{\nextShloka}{%
  \stepcounter{shlokacount}\stepcounter{shlokalink}%
  
  % 1. Construct a UNIQUE label based on the current mode
  \ifpadaccheda
     \def\currentLabel{track:split:\arabic{shlokalink}}%
  \else
     \def\currentLabel{track:moola:\arabic{shlokalink}}%
  \fi
  
  % 2. Write the label to the AUX file
  \label{\currentLabel}%
  
  % 3. Retrieve the TRUE page number of THIS label
  \edef\truePageNum{\getpagerefnumber{\currentLabel}}%
  
  % 4. Apply the Page Offset Math
  % We check if truePageNum > 0 to prevent errors on the very first compile run
  \ifnum\truePageNum>0
      \ifpadaccheda
        % Split Mode: Go BACK to Moola
        \num\numexpr\truePageNum-\PageOffset\relax
        \edef\targetPage{page.\the\num}%
      \else
        % Moola Mode: Go FORWARD to Split
        \num\numexpr\truePageNum+\PageOffset\relax
        \edef\targetPage{page.\the\num}%
      \fi
      % 5. Create the Link
      \hyperlink{\targetPage}{\devanumber\c@shlokacount}%
  \else
      % Fallback for first run (before aux is ready) - just print number
      \devanumber\c@shlokacount%
  \fi
}

% A zero-width box with the height of 'र्क॑' (tallest) and depth of 'ष्ट्र्य्' (deepest)
% Adjust the characters inside {} to be your "worst case" scenario.
% \newcommand{\ShlokaStrut}{\vphantom{र्क॑ ष्ट्र्य्}}
\newcommand{\ShlokaStrut}{\vphantom{र्क ष्ट्रत्}}

\newcommand{\resetShloka}{\setcounter{shlokacount}{0}}
\resetShloka

\newcommand{\twolineshloka}{\@ifstar
                     \twolineshlokaStar%
                     \twolineshlokaNoStar%
}

\newcommand{\onelineshloka}{\@ifstar
                     \onelineshlokaStar%
                     \onelineshlokaNoStar%
}

\newcommand{\twolineshlokaNoStar}[2]{%
% \ShlokaAnchor% <--- NEW PARALLEL COUNTER INCREMENTS HERE
\vskip\shlokavskip\vsp
\setbox\@tempboxa=\hbox{\ShlokaStrut #1}%
\setbox\@tempboxb=\hbox{\ShlokaStrut #2}%
\ifdim\wd\@tempboxa>\wd\@tempboxb%
\@tempdima=\wd\@tempboxa%
\shlokatopskip\hbox to \linewidth{\hfil\vbox{\hbox{\box\@tempboxa ।}\shlokamidskip\hbox{\hbox to \@tempdima{\unhbox\@tempboxb}॥\relax \nextShloka॥}}\hfil}%
\else%
\@tempdima=\wd\@tempboxb%
\shlokatopskip\hbox to \linewidth{\hfil\vbox{\hbox{\hbox to \@tempdima{\unhbox\@tempboxa}।}\shlokamidskip\hbox{\box\@tempboxb॥\relax \nextShloka॥}}\hfil}%
\fi}

\newcommand{\onelineshlokaNoStar}[1]{%
\vskip\shlokavskip\vsp
\centerline{\ShlokaStrut #1॥\nextShloka॥}}

\newcommand{\onelineshlokaStar}[1]{%
\vskip\shlokavskip\vsp
\centerline{\ShlokaStrut #1।}}


\newcommand{\annotwolineshloka}[3]{%
\vskip\shlokavskip\vsp
\setbox\@tempboxa=\hbox{\ShlokaStrut #1}%
\setbox\@tempboxb=\hbox{\ShlokaStrut #2}%
\ifdim\wd\@tempboxa>\wd\@tempboxb%
\@tempdima=\wd\@tempboxa%
\shlokatopskip\hbox to \linewidth{\hfil\vbox{\hbox{\box\@tempboxa ।}\shlokamidskip\hbox{\hbox to \@tempdima{\unhbox\@tempboxb}॥\relax \nextShloka॥\footnotesize{#3}\hspace{-3ex}}}\hfil}%
\else%
\@tempdima=\wd\@tempboxb%
\shlokatopskip\hbox to \linewidth{\hfil\vbox{\hbox{\hbox to \@tempdima{\unhbox\@tempboxa}।}\shlokamidskip\hbox{\box\@tempboxb॥\relax \nextShloka॥\footnotesize{#3}\hspace{-3ex}}}\hfil}%
\fi}

\newcommand{\twolineshlokaStar}[2]{%
\vskip\shlokavskip\vsp
\setbox\@tempboxa=\hbox{\ShlokaStrut #1}%
\setbox\@tempboxb=\hbox{\ShlokaStrut #2}%
\ifdim\wd\@tempboxa>\wd\@tempboxb%
\@tempdima=\wd\@tempboxa%
\shlokatopskip\hbox to \linewidth{\hfil\vbox{\hbox{\box\@tempboxa ।}\shlokamidskip\hbox{\hbox to \@tempdima{\unhbox\@tempboxb}॥}}\hfil}%
\else%
\@tempdima=\wd\@tempboxb%
\shlokatopskip\hbox to \linewidth{\hfil\vbox{\hbox{\hbox to \@tempdima{\unhbox\@tempboxa}।}\shlokamidskip\hbox{\box\@tempboxb॥}}\hfil}%
\fi}

\newcommand{\threelineshloka}{\@ifstar
                     \threelineshlokaStar%
                     \threelineshlokaNoStar%
}

\newcommand{\threelineshlokaStar}[3]{%
\vskip\shlokavskip\vsp
\setbox\@tempboxa=\hbox{\ShlokaStrut #1}%
\setbox\@tempboxb=\hbox{\ShlokaStrut #2}%
\setbox\@tempboxc=\hbox{\ShlokaStrut #3}%
\ifdim\wd\@tempboxa>\wd\@tempboxb%
\@tempdima=\wd\@tempboxa%
\ifdim\wd\@tempboxa>\wd\@tempboxc%
\shlokatopskip\hbox to \linewidth{\hfil\vbox{\hbox{\box\@tempboxa ।}\shlokamidskip%
\hbox{\hbox to \@tempdima{\unhbox\@tempboxb}।}\shlokamidskip%
\hbox{\hbox to \@tempdima{\unhbox\@tempboxc}॥}}\hfil}%
\else%
\@tempdima=\wd\@tempboxc%
\shlokatopskip\hbox to \linewidth{\hfil\vbox{\hbox{\hbox to \@tempdima{\unhbox\@tempboxa}।}\shlokamidskip%
\hbox{\hbox to \@tempdima{\unhbox\@tempboxb}।}\shlokamidskip%
\hbox{\box\@tempboxc॥}}\hfil}%
\fi%
\else%
\@tempdima=\wd\@tempboxb%
\ifdim\wd\@tempboxb>\wd\@tempboxc%
\shlokatopskip\hbox to \linewidth{\hfil\vbox{\hbox{\hbox to \@tempdima{\unhbox\@tempboxa}।}\shlokamidskip%
\hbox{\hbox{\box\@tempboxb।}}\shlokamidskip
\hbox{\hbox to \@tempdima{\unhbox\@tempboxc}॥}}\hfil}%
\else%
\@tempdima=\wd\@tempboxc%
\shlokatopskip\hbox to \linewidth{\hfil\vbox{\hbox{\hbox to \@tempdima{\unhbox\@tempboxa}।}\shlokamidskip%
\hbox{\hbox to \@tempdima{\unhbox\@tempboxb}।}\shlokamidskip%
\hbox{\box\@tempboxc॥}}\hfil}%
\fi%
\fi}


\newcommand{\threelineshlokaNoStar}[3]{%
\vskip\shlokavskip\vsp
\setbox\@tempboxa=\hbox{\ShlokaStrut #1}%
\setbox\@tempboxb=\hbox{\ShlokaStrut #2}%
\setbox\@tempboxc=\hbox{\ShlokaStrut #3}%
\ifdim\wd\@tempboxa>\wd\@tempboxb%
\@tempdima=\wd\@tempboxa%
\ifdim\wd\@tempboxa>\wd\@tempboxc%
\shlokatopskip\hbox to \linewidth{\hfil\vbox{\hbox{\box\@tempboxa ।}\shlokamidskip%
\hbox{\hbox to \@tempdima{\unhbox\@tempboxb}।}\shlokamidskip%
\hbox{\hbox to \@tempdima{\unhbox\@tempboxc}॥\relax \nextShloka॥}}\hfil}%
\else%
\@tempdima=\wd\@tempboxc%
\shlokatopskip\hbox to \linewidth{\hfil\vbox{\hbox{\hbox to \@tempdima{\unhbox\@tempboxa}।}\shlokamidskip%
\hbox{\hbox to \@tempdima{\unhbox\@tempboxb}।}\shlokamidskip%
\hbox{\box\@tempboxc॥\relax \nextShloka॥}}\hfil}%
\fi%
\else%
\@tempdima=\wd\@tempboxb%
\ifdim\wd\@tempboxb>\wd\@tempboxc%
\shlokatopskip\hbox to \linewidth{\hfil\vbox{\hbox{\hbox to \@tempdima{\unhbox\@tempboxa}।}\shlokamidskip%
\hbox{\hbox{\box\@tempboxb।}}\shlokamidskip
\hbox{\hbox to \@tempdima{\unhbox\@tempboxc}॥\relax \nextShloka॥}}\hfil}%
\else%
\@tempdima=\wd\@tempboxc%
\shlokatopskip\hbox to \linewidth{\hfil\vbox{\hbox{\hbox to \@tempdima{\unhbox\@tempboxa}।}\shlokamidskip%
\hbox{\hbox to \@tempdima{\unhbox\@tempboxb}।}\shlokamidskip%
\hbox{\box\@tempboxc॥\relax \nextShloka॥}}\hfil}%
\fi%
\fi}

\newcommand{\fourlineindentedshloka}{\@ifstar
                     \fourlineindentedshlokaStar%
                     \fourlineindentedshlokaNoStar%
}

\newcommand{\fourlineindentedshlokaNoStar}[4]{%
\vskip\shlokavskip\vsp
\setbox\@tempboxa=\hbox{\ShlokaStrut #1}%
\setbox\@tempboxb=\hbox{\ShlokaStrut #3}%
\setbox\@tempboxc=\hbox{\ShlokaStrut #2}%
\setbox\@tempboxd=\hbox{\ShlokaStrut #4}%
\ifdim\wd\@tempboxa>\wd\@tempboxb%
\@tempdima=\wd\@tempboxa%
\ifdim\wd\@tempboxc>\wd\@tempboxd%
\@tempdimb=\wd\@tempboxc%
\shlokatopskip\hbox to \linewidth{\hfil\vbox{\hbox{\box\@tempboxa}\shlokamidskip%
\hbox{\hskip\shlokaspaceskip\box\@tempboxc ।}\shlokamidskip%
\hbox{\hbox to \@tempdima{\unhbox\@tempboxb}}\shlokamidskip%
\hbox{\hskip\shlokaspaceskip\hbox to \@tempdimb{\unhbox\@tempboxd}॥\relax \nextShloka॥}}\hfil}%
\else%
\@tempdimb=\wd\@tempboxd%
\shlokatopskip\hbox to \linewidth{\hfil\vbox{\hbox{\box\@tempboxa}\shlokamidskip%
\hbox{\hskip\shlokaspaceskip\hbox to \@tempdimb{\unhbox\@tempboxc}।}\shlokamidskip%
\hbox{\hbox to \@tempdima{\unhbox\@tempboxb}}\shlokamidskip%
\hbox{\hskip\shlokaspaceskip\box\@tempboxd ॥\relax \nextShloka॥}}\hfil}%
\fi%
\else%
\@tempdima=\wd\@tempboxb%
\ifdim\wd\@tempboxc>\wd\@tempboxd%
\@tempdimb=\wd\@tempboxc%
\shlokatopskip\hbox to \linewidth{\hfil\vbox{\hbox{\hbox to \@tempdima{\unhbox\@tempboxa}}\shlokamidskip%
\hbox{\hskip\shlokaspaceskip\box\@tempboxc ।}\shlokamidskip%
\hbox{\box\@tempboxb}\shlokamidskip%
\hbox{\hskip\shlokaspaceskip\hbox to \@tempdimb{\unhbox\@tempboxd}॥\relax \nextShloka॥}}\hfil}%
\else%
\@tempdimb=\wd\@tempboxd%
\shlokatopskip\hbox to \linewidth{\hfil\vbox{\hbox{\hbox to \@tempdima{\unhbox\@tempboxa}}\shlokamidskip%
\hbox{\hskip\shlokaspaceskip\hbox to \@tempdimb{\unhbox\@tempboxc}।}\shlokamidskip%
\hbox{\box\@tempboxb}\shlokamidskip%
\hbox{\hskip\shlokaspaceskip\box\@tempboxd ॥\relax \nextShloka॥}}\hfil}%
\fi%
\fi}

\newcommand{\fourlineindentedshlokaStar}[4]{%
\vskip\shlokavskip\vsp
\setbox\@tempboxa=\hbox{\ShlokaStrut #1}%
\setbox\@tempboxb=\hbox{\ShlokaStrut #3}%
\setbox\@tempboxc=\hbox{\ShlokaStrut #2}%
\setbox\@tempboxd=\hbox{\ShlokaStrut #4}%
\ifdim\wd\@tempboxa>\wd\@tempboxb%
\@tempdima=\wd\@tempboxa%
\ifdim\wd\@tempboxc>\wd\@tempboxd%
\@tempdimb=\wd\@tempboxc%
\shlokatopskip\hbox to \linewidth{\hfil\vbox{\hbox{\box\@tempboxa}\shlokamidskip%
\hbox{\hskip\shlokaspaceskip\box\@tempboxc ।}\shlokamidskip%
\hbox{\hbox to \@tempdima{\unhbox\@tempboxb}}\shlokamidskip%
\hbox{\hskip\shlokaspaceskip\hbox to \@tempdimb{\unhbox\@tempboxd}॥}}\hfil}%
\else%
\@tempdimb=\wd\@tempboxd%
\shlokatopskip\hbox to \linewidth{\hfil\vbox{\hbox{\box\@tempboxa}\shlokamidskip%
\hbox{\hskip\shlokaspaceskip\hbox to \@tempdimb{\unhbox\@tempboxc}।}\shlokamidskip%
\hbox{\hbox to \@tempdima{\unhbox\@tempboxb}}\shlokamidskip%
\hbox{\hskip\shlokaspaceskip\box\@tempboxd ॥}}\hfil}%
\fi%
\else%
\@tempdima=\wd\@tempboxb%
\ifdim\wd\@tempboxc>\wd\@tempboxd%
\@tempdimb=\wd\@tempboxc%
\shlokatopskip\hbox to \linewidth{\hfil\vbox{\hbox{\hbox to \@tempdima{\unhbox\@tempboxa}}\shlokamidskip%
\hbox{\hskip\shlokaspaceskip\box\@tempboxc ।}\shlokamidskip%
\hbox{\box\@tempboxb}\shlokamidskip%
\hbox{\hskip\shlokaspaceskip\hbox to \@tempdimb{\unhbox\@tempboxd}॥}}\hfil}%
\else%
\@tempdimb=\wd\@tempboxd%
\shlokatopskip\hbox to \linewidth{\hfil\vbox{\hbox{\hbox to \@tempdima{\unhbox\@tempboxa}}\shlokamidskip%
\hbox{\hskip\shlokaspaceskip\hbox to \@tempdimb{\unhbox\@tempboxc}।}\shlokamidskip%
\hbox{\box\@tempboxb}\shlokamidskip%
\hbox{\hskip\shlokaspaceskip\box\@tempboxd ॥}}\hfil}%
\fi%
\fi}

\newcommand{\annofourlineindentedshloka}[5]{%annotated fourlineindentedshloka
\vskip\shlokavskip\vsp
\setbox\@tempboxa=\hbox{\ShlokaStrut #1}%
\setbox\@tempboxb=\hbox{\ShlokaStrut #3}%
\setbox\@tempboxc=\hbox{\ShlokaStrut #2}%
\setbox\@tempboxd=\hbox{\ShlokaStrut #4}%
\ifdim\wd\@tempboxa>\wd\@tempboxb%
\@tempdima=\wd\@tempboxa%
\ifdim\wd\@tempboxc>\wd\@tempboxd%
\@tempdimb=\wd\@tempboxc%
\shlokatopskip\hbox to \linewidth{\hfil\vbox{\hbox{\box\@tempboxa}\shlokamidskip%
\hbox{\hskip\shlokaspaceskip\box\@tempboxc ।}\shlokamidskip%
\hbox{\hbox to \@tempdima{\unhbox\@tempboxb}}\shlokamidskip%
\hbox{\hskip\shlokaspaceskip\hbox to \@tempdimb{\unhbox\@tempboxd}॥\relax \nextShloka॥\footnotesize{#5}\hspace{-3ex}}}\hfil}%
\else%
\@tempdimb=\wd\@tempboxd%
\shlokatopskip\hbox to \linewidth{\hfil\vbox{\hbox{\box\@tempboxa}\shlokamidskip%
\hbox{\hskip\shlokaspaceskip\hbox to \@tempdimb{\unhbox\@tempboxc}।}\shlokamidskip%
\hbox{\hbox to \@tempdima{\unhbox\@tempboxb}}\shlokamidskip%
\hbox{\hskip\shlokaspaceskip\box\@tempboxd ॥\relax \nextShloka॥\footnotesize{#5}\hspace{-3ex}}}\hfil}%
\fi%
\else%
\@tempdima=\wd\@tempboxb%
\ifdim\wd\@tempboxc>\wd\@tempboxd%
\@tempdimb=\wd\@tempboxc%
\shlokatopskip\hbox to \linewidth{\hfil\vbox{\hbox{\hbox to \@tempdima{\unhbox\@tempboxa}}\shlokamidskip%
\hbox{\hskip\shlokaspaceskip\box\@tempboxc ।}\shlokamidskip%
\hbox{\box\@tempboxb}\shlokamidskip%
\hbox{\hskip\shlokaspaceskip\hbox to \@tempdimb{\unhbox\@tempboxd}॥\relax \nextShloka॥\footnotesize{#5}\hspace{-3ex}}}\hfil}%
\else%
\@tempdimb=\wd\@tempboxd%
\shlokatopskip\hbox to \linewidth{\hfil\vbox{\hbox{\hbox to \@tempdima{\unhbox\@tempboxa}}\shlokamidskip%
\hbox{\hskip\shlokaspaceskip\hbox to \@tempdimb{\unhbox\@tempboxc}।}\shlokamidskip%
\hbox{\box\@tempboxb}\shlokamidskip%
\hbox{\hskip\shlokaspaceskip\box\@tempboxd ॥\relax \nextShloka॥\footnotesize{#5}\hspace{-3ex}}}\hfil}%
\fi%
\fi}

\newcommand{\fourlineshloka}[4]{%
\vskip\shlokavskip\vsp
\setbox\@tempboxa=\hbox{\ShlokaStrut #1}%
\setbox\@tempboxb=\hbox{\ShlokaStrut #3}%
\setbox\@tempboxc=\hbox{\ShlokaStrut #2}%
\setbox\@tempboxd=\hbox{\ShlokaStrut #4}%
\ifdim\wd\@tempboxa>\wd\@tempboxb%
\@tempdima=\wd\@tempboxa%
\ifdim\wd\@tempboxc>\wd\@tempboxd%
\@tempdimb=\wd\@tempboxc%
\shlokatopskip\hbox to \linewidth{\hfil\vbox{\hbox{\box\@tempboxa}\shlokamidskip%
\hbox{\hskip\shlokaspaceskip\box\@tempboxc}\shlokamidskip%
\hbox{\hbox to \@tempdima{\unhbox\@tempboxb}}\shlokamidskip%
\hbox{\hskip\shlokaspaceskip\hbox to \@tempdimb{\unhbox\@tempboxd}}}\hfil}%
\else%
\@tempdimb=\wd\@tempboxd%
\shlokatopskip\hbox to \linewidth{\hfil\vbox{\hbox{\box\@tempboxa}\shlokamidskip%
\hbox{\hskip\shlokaspaceskip\hbox to \@tempdimb{\unhbox\@tempboxc}}\shlokamidskip%
\hbox{\hbox to \@tempdima{\unhbox\@tempboxb}}\shlokamidskip%
\hbox{\hskip\shlokaspaceskip\box\@tempboxd}}\hfil}%
\fi%
\else%
\@tempdima=\wd\@tempboxb%
\ifdim\wd\@tempboxc>\wd\@tempboxd%
\@tempdimb=\wd\@tempboxc%
\shlokatopskip\hbox to \linewidth{\hfil\vbox{\hbox{\hbox to \@tempdima{\unhbox\@tempboxa}}\shlokamidskip%
\hbox{\hskip\shlokaspaceskip\box\@tempboxc}\shlokamidskip%
\hbox{\box\@tempboxb}\shlokamidskip%
\hbox{\hskip\shlokaspaceskip\hbox to \@tempdimb{\unhbox\@tempboxd}}}\hfil}%
\else%
\@tempdimb=\wd\@tempboxd%
\shlokatopskip\hbox to \linewidth{\hfil\vbox{\hbox{\hbox to \@tempdima{\unhbox\@tempboxa}}\shlokamidskip%
\hbox{\hskip\shlokaspaceskip\hbox to \@tempdimb{\unhbox\@tempboxc}}\shlokamidskip%
\hbox{\box\@tempboxb}\shlokamidskip%
\hbox{\hskip\shlokaspaceskip\box\@tempboxd}}\hfil}%
\fi%
\fi}

\newcommand{\THREElineshloka}[3]{%
\vskip\shlokavskip\vsp
\setbox\@tempboxa=\hbox{\ShlokaStrut #1}%
\setbox\@tempboxb=\hbox{\ShlokaStrut #2}%
\setbox\@tempboxc=\hbox{\ShlokaStrut #3}%
\ifdim\wd\@tempboxa>\wd\@tempboxb%
\@tempdima=\wd\@tempboxa%
\ifdim\wd\@tempboxa>\wd\@tempboxc%
\shlokatopskip\hbox to \linewidth{\hfil\vbox{\hbox{\box\@tempboxa}%
\hbox{\box\@tempboxb}%
\hbox{\hbox to \@tempdima{\unhbox\@tempboxb}}%
\hbox{\hbox to \@tempdimb{\unhbox\@tempboxc}}}\hfil}%
\else%
\@tempdimb=\wd\@tempboxd%
\shlokatopskip\hbox to \linewidth{\hfil\vbox{\hbox{\box\@tempboxa}%
\hbox{\hskip\shlokaspaceskip\hbox to \@tempdimb{\unhbox\@tempboxc}}%
\hbox{\hbox to \@tempdima{\unhbox\@tempboxb}}%
\hbox{\hskip\shlokaspaceskip\box\@tempboxd}}\hfil}%
\fi%
\else%
\@tempdima=\wd\@tempboxb%
\ifdim\wd\@tempboxc>\wd\@tempboxd%
\@tempdimb=\wd\@tempboxc%
\shlokatopskip\hbox to \linewidth{\hfil\vbox{\hbox{\hbox to \@tempdima{\unhbox\@tempboxa}}%
\hbox{\hskip\shlokaspaceskip\box\@tempboxc}%
\hbox{\box\@tempboxb}%
\hbox{\hskip\shlokaspaceskip\hbox to \@tempdimb{\unhbox\@tempboxd}}}\hfil}%
\else%
\@tempdimb=\wd\@tempboxd%
\shlokatopskip\hbox to \linewidth{\hfil\vbox{\hbox{\hbox to \@tempdima{\unhbox\@tempboxa}}%
\hbox{\hskip\shlokaspaceskip\hbox to \@tempdimb{\unhbox\@tempboxc}}%
\hbox{\box\@tempboxb}%
\hbox{\hskip\shlokaspaceskip\box\@tempboxd}}\hfil}%
\fi%
\fi}

\newcommand{\sect}[1]{%
%\section[#1]{\fontspec[FakeBold=1.0,FakeStretch=1.0,Script=Devanagari,Mapping=tex-text]{Siddhanta}॥#1॥}%
\section[#1]{\fontspec[FakeBold=1.0,FakeStretch=1.0,Script=Devanagari,Mapping=tex-text]{Sanskrit 2003}॥#1॥}%
}

\newcommand{\chapt}[1]{%
%\chapter[#1]{\fontspec[FakeBold=1.0,FakeStretch=1.0,Script=Devanagari,Mapping=tex-text]{Siddhanta}॥#1॥}%
\chapter[#1]{\fontspec[FakeBold=1.0,FakeStretch=1.0,Script=Devanagari,Mapping=tex-text]{Sanskrit 2003}॥#1॥}%
}

\let\origclearpage\clearpage
\renewcommand{\clearpage}{
    \vfill
    \origclearpage
}
\let\origdoublepage\cleardoublepage
\newcommand{\clearemptydoublepage}{%
  {\pagestyle{empty}\origdoublepage}%
}

\newcommand{\dnsub}[1]{
\medskip
\centerline{\Large\fontspec[FakeBold=1.0,FakeStretch=1.08,Script=Devanagari,Mapping=tex-text]{Sanskrit 2003} ॥#1॥ }\nopagebreak[4]
%\centerline{\Large\fontspec[FakeBold=1.0,FakeStretch=1.2,Script=Devanagari,Mapping=tex-text]{Siddhanta} ॥#1॥ }\nopagebreak[4]
\smallskip
}

\newcommand{\uvacha}[1]{
\medskip
\centerline{\fontspec[FakeBold=1.0,Script=Devanagari,Mapping=tex-text]{Sanskrit 2003}{#1}}\nopagebreak[4]
%\centerline{\fontspec[FakeBold=1.0,Script=Devanagari,Mapping=tex-text]{Siddhanta}{#1}}\nopagebreak[4]
%\smallskip
}

\RequirePackage{bbding}
\newcommand{\closesection}{\medskip\centerline{\EightFlowerPetal\EightFlowerPetal\EightFlowerPetal}}
\newcommand{\closesub}{\medskip\centerline{\EightFlowerPetal}}
